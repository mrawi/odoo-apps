<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_delivery_document_inherit" inherit_id="stock.report_delivery_document">
        <xpath expr="//table[@name='stock_backorder_table']" position="replace">

            <table class="table table-sm" name="stock_backorder_table" style="table-layout: fixed;">
                <thead>
                    <tr>
                        <th name="th_sb_product">
                            <strong>Product</strong>
                        </th>
                        <th name="th_sb_sheet">
                            <strong>Sheet</strong>
                        </th>
                        <th/>
                        <th name="th_sb_quantity" class="text-center">
                            <strong>Quantity</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="backorders" t-as="backorder">
                        <t t-set="bo_lines" t-value="backorder.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                        <tr t-foreach="bo_lines" t-as="bo_line">
                            <td class="w-auto">
                                <span t-field="bo_line.product_id"/>
                                <p t-if="bo_line.description_picking != bo_line.product_id.name and bo_line.description_picking != bo_line.product_id.display_name">
                                    <span t-field="bo_line.description_picking"/>
                                </p>
                            </td>
                            <td class="w-auto">
                                <span t-field="bo_line.sheet_num"/>

                            </td>
                            <td/>
                            <td class="text-center w-auto">
                                <span t-field="bo_line.product_uom_qty"/>
                                <span t-field="bo_line.product_uom"/>
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>


        </xpath>
        <xpath expr="//table[@name='stock_move_line_table']" position="replace">
            <table class="table table-sm mt48" t-if="o.move_line_ids and o.state=='done'" name="stock_move_line_table">

                 <thead>
                    <tr>
                        <th name="th_sm_product">
                            <strong>Product</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>Sheets</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>Ordered</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>UOM</strong>
                        </th>
                        <th name="th_sm_quantity">
                            <strong>Delivered</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="total_sheets" t-value="0"/>
                    <t t-set="lines" t-value="o.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                    <tr t-foreach="lines" t-as="move" style="text-align:center;">
                        <t t-set="total_sheets" t-value="total_sheets+move.sheet_num"/>
                        <td>
                            <span t-field="move.product_id"/>
                            <p t-if="move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                                <span t-field="move.description_picking"/>
                            </p>
                        </td>
                        <td>
                            <span t-field="move.sheet_num"/>
                        </td>
                        <td>
                            <span t-field="move.product_uom_qty"/>
                        </td>
                        <td>
                            <span t-field="move.product_uom"/>
                        </td>
                        <td>
                            <span t-field="move.quantity_done"/>
                            <span t-field="move.product_uom"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;">
                            <strong>Total Sheets</strong>
                        </td>
                        <td colspan="4" style="padding-left:55px;">
                            <span t-esc="total_sheets"/>
                        </td>
                    </tr>
                </tbody>

            </table>

        </xpath>
        <xpath expr="//table[@name='stock_move_table']" position="replace">
            <table class="table table-sm" t-if="o.state!='done'" name="stock_move_table">
                <thead>
                    <tr>
                        <th name="th_sm_product">
                            <strong>Product</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>Sheets</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>Ordered</strong>
                        </th>
                        <th name="th_sm_ordered">
                            <strong>UOM</strong>
                        </th>
                        <th name="th_sm_quantity">
                            <strong>Delivered</strong>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="total_sheets" t-value="0"/>
                    <t t-set="lines" t-value="o.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                    <tr t-foreach="lines" t-as="move" style="text-align:center;">
                        <t t-set="total_sheets" t-value="total_sheets+move.sheet_num"/>
                        <td>
                            <span t-field="move.product_id"/>
                            <p t-if="move.description_picking != move.product_id.name and move.description_picking != move.product_id.display_name">
                                <span t-field="move.description_picking"/>
                            </p>
                        </td>
                        <td>
                            <span t-field="move.sheet_num"/>
                        </td>
                        <td>
                            <span t-field="move.product_uom_qty"/>
                        </td>
                        <td>
                            <span t-field="move.product_uom"/>
                        </td>
                        <td>
                            <span t-field="move.quantity_done"/>
                            <span t-field="move.product_uom"/>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align:center;">
                            <strong>Total Sheets</strong>
                        </td>
                        <td colspan="4" style="padding-left:55px;">
                            <span t-esc="total_sheets"/>
                        </td>
                    </tr>
                </tbody>
            </table>

        </xpath>
    </template>









    <template id="stock_report_delivery_has_serial_move_line" inherit_id="stock.stock_report_delivery_has_serial_move_line">
        <td>
            <span t-field="move_line.product_id"/>
            <!-- this is an annoying workaround for the multiple types of descriptions (often auto-filled) that we do not want to print -->
            <!-- this makes it so we can pre-filter the descriptions in inherited templates since we cannot extend the standard "if" condition -->
            <!-- let's agree that pre-filtered descriptions will be set to "" -->
            <t t-if="not description and description != ''">
                <t t-set="description" t-value="move_line.move_id.description_picking"/>
            </t>
            <p t-if="description !='' and description != move_line.product_id.name">
                <span t-esc="description"/>
            </p>
        </td>
        <td>
            <span t-esc="move.sheet_num"/>
        </td>
        <t t-if="has_serial_number" name="move_line_lot">
            <td><span t-field="move_line.lot_id.name"/></td>
        </t>
        <td class="text-center" name="move_line_lot_qty_done">
            <span t-field="move_line.qty_done"/>
            <span t-field="move_line.product_uom_id"/>
        </td>
    </template>
<!--    <template id="stock_report_delivery_aggregated_move_lines" inherit_id="stock.stock_report_delivery_aggregated_move_lines">-->
<!--        <tr t-foreach="aggregated_lines" t-as="line">-->
<!--            <td>-->
<!--                <span t-esc="aggregated_lines[line]['name']"/>-->
<!--                <p t-if="aggregated_lines[line]['description']">-->
<!--                    <span t-esc="aggregated_lines[line]['description']"  t-options="{'widget': 'text'}"/>-->
<!--                </p>-->
<!--            </td>-->
<!--            <td class="text-center" name="move_line_aggregated_qty_ordered">-->
<!--                <span t-esc="aggregated_lines[line]['qty_ordered']"-->
<!--                    t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>-->
<!--                <span t-esc="aggregated_lines[line]['product_uom'].name"/>-->
<!--            </td>-->
<!--            <td class="text-center" name="move_line_aggregated_sheet">-->
<!--                <span t-esc="aggregated_lines[line]['sheet_num']"-->
<!--                    t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>-->
<!--                <span t-esc="aggregated_lines[line]['product_uom'].name"/>-->
<!--            </td>-->
<!--            <td class="text-center" name="move_line_aggregated_qty_done">-->
<!--                <t t-if="aggregated_lines[line]['qty_done']">-->
<!--                    <span t-esc="aggregated_lines[line]['qty_done']"-->
<!--                        t-options="{'widget': 'float', 'decimal_precision': 'Product Unit of Measure'}"/>-->
<!--                    <span t-esc="aggregated_lines[line]['product_uom'].name"/>-->
<!--                </t>-->
<!--            </td>-->
<!--        </tr>-->
<!--    </template>-->

</odoo>